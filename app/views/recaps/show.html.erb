<!-- Banner with title, author, rating -->
<div class="banner" style="background-image: url(<%= image_url "banner.png" %>);">
  <div class="container">
    <h6><strong>Author:</strong> J.K. Rowling</h6>
    <h1><strong>Your chosen book recap.</strong></h1>
    <div class="mt-3">
      <% @recap.ratings.average("star").round.times do %>
        <i class="fas fa-star" style="color: #F6AE2D;"></i>
      <% end %>
      <strong><%= @recap.ratings.average("star").round(1) %></strong>
    </div>
    <a href="#rating-cards" class="rating-link"><p><%= @recap.ratings.count %> Ratings</p></a>
  </div>
</div>


<div class="container">
  <h5>Recaped by: <%=@recap.user.username %> </h5>
  <ul class="nav nav-pills mb-3" style="display: flex; justify-content: center;" id="pills-tab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Description</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Summary</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Ratings</button>
    </li>
  </ul>
  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
      <%= @description = @recap.book.description %>
    </div>
    <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
      <%=@recap.summary%>
    </div>
    <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
      <%@ratings = Rating.where(recap_id: @recap.id)%>
      <%@ratings.each do |rating|%>
        <%= rating.comment%>
        <%= rating.star%>
      <%end%>
    </div>
  </div>
</div>

<!-- Recap cards -->
<div class="recap-cards">
  <% @recaps = Recap.where(book_id: @recap.book.id) %>
  <% @recaps.each do |recap| %>
    <%= link_to recap, style:"text-decoration: none; color: black" do %>
    <div class="card-all">
      <img src="<%= recap.book.photo_url %>">
      <div class= "card-all-infos">
        <h2><%= recap.title %></h2>
    <div style="display: flex; margin-top: 5px;">
      <p style="margin-right: 5px;"><%= recap.user.username %></p>
        <% if recap.user.avatar.attached? %>
            <%= image_tag recap.user.avatar, class: "recap-avatar" %>
          <% else %>
            <%= image_tag "default-avatar.png", class: "recap-avatar"  %>
        <% end %>
    </div>
      </div>
    </div>
    <%end%>
  <%end%>
</div>

<!-- Recap summary -->
<h1><%= @recap.summary %></h1>

<!-- Review cards -->
<div class="review-container" id="rating-cards">
 <div class="row">
  <div class="col-12 col-md-6 col-lg-6">
    <div class="review-header">
      <h3>Reviews on <%= @recap.user.username %>'s recap</h3>
      <button type="button" class="btn-action" data-bs-toggle="modal" data-bs-target="#exampleModal">Add review</button>
    </div>

      <% @recap.ratings.each do |r| %>
        <div class="review-card">
          <p id="rating-<%= r.id %>"></p>
            <div style="display: flex;">
              <div style="margin-right: 10px;">
                <% if r.user.avatar.attached? %>
                  <%= image_tag r.user.avatar, class: "avatar" %>
                <% else %>
                  <%= image_tag "default-avatar.png", class: "avatar" %>
                <% end %>
              </div>
            <div>
              <h4><%= r.user.username %></h4>
              <p> <i class="fas fa-star" style="color: #F6AE2D;"></i> <%= r.star.to_f %></p>
            </div>
          </div>
          <p><%= r.comment %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Modal with review form -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Tell us what you think</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= simple_form_for([ @recap, @rating ], remote: true) do |f| %>
          <%= f.input :comment, label: "Comment"  %>
          <%= f.input :star, label: "Rating", collection: 0..5 %>
          <%= f.submit "Submit review", class: "btn-action" %>
        <% end %>
      </div>
    </div>
  </div>
</div>
